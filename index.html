<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=640, initial-scale=1, user-scalable=no" />
  <title>CanlÄ± Kurlar</title>
  <style>
    body{margin:0;background:#0f1115;color:#fff;font-family:Segoe UI,Roboto,Arial,sans-serif;width:640px;height:1152px;overflow:hidden;position:relative;}
    header{text-align:center;padding:25px 10px 5px;font-size:28px;font-weight:600;color:#3aa0ff;}
    #time{text-align:center;font-size:13px;color:#999;margin-bottom:10px;}
    footer{position:absolute;bottom:0;left:0;width:100%;display:flex;justify-content:space-between;align-items:center;padding:10px 15px;background:rgba(0,0,0,0.8);backdrop-filter:blur(8px);border-top:1px solid #222;}
    .card{flex:1;text-align:center;margin:0 5px;background:#1a1f29;border-radius:12px;padding:8px 6px;font-size:18px;}
    .label{font-size:12px;color:#aaa;margin-bottom:4px;}
    .value{font-weight:bold;font-size:22px;transition:color .3s;}
    .up{color:#18c964;} .down{color:#ff4d4f;}
  </style>
</head>
<body>
  <header>ðŸ’± CanlÄ± Kurlar</header>
  <div id="time">YÃ¼kleniyor...</div>

  <footer>
    <div class="card"><div class="label">USD / TRY</div><div id="usd" class="value">--</div></div>
    <div class="card"><div class="label">EUR / TRY</div><div id="eur" class="value">--</div></div>
    <div class="card"><div class="label">GBP / TRY</div><div id="gbp" class="value">--</div></div>
    <div class="card"><div class="label">GRAM ALTIN</div><div id="gold" class="value">--</div></div>
  </footer>

<script>
const el = id => document.getElementById(id);
const last = {};

function update(id, val){
  const e = el(id);
  if(!e) return;
  const v = parseFloat(val);
  const prev = last[id];
  last[id] = v;
  e.textContent = isNaN(v) ? "--" : v.toFixed(2);
  if (prev !== undefined && !isNaN(v)) {
    if (v > prev) e.className = "value up";
    else if (v < prev) e.className = "value down";
    else e.className = "value";
  }
}

function fetchWithTimeout(url, ms=8000){
  const ctrl = new AbortController();
  const t = setTimeout(()=>ctrl.abort(), ms);
  return fetch(url, { signal: ctrl.signal }).finally(()=>clearTimeout(t));
}

async function refresh(){
  try{
    // 1) USD bazlÄ± kurlar (currency dataset)
    const usdRes = await fetchWithTimeout("https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/usd.json");
    const usdJson = await usdRes.json();
    if(!usdJson || !usdJson.usd) throw new Error("USD verisi boÅŸ");
    const r = usdJson.usd;
    const usdtry = r.try;    // 1 USD = ? TRY
    const usdeur = r.eur;    // 1 USD = ? EUR
    const usdgbp = r.gbp;    // 1 USD = ? GBP
    const eurtry = usdtry / usdeur;
    const gbptry = usdtry / usdgbp;

    update("usd", usdtry);
    update("eur", eurtry);
    update("gbp", gbptry);

    // 2) Ons (XAU) fiyatÄ± â€” canlÄ±-ish endpoint
    // Bu endpoint genelde gÃ¼ncel ons fiyatÄ±nÄ± verir: data-asg.goldprice.org/dbXRates/USD
    const goldRes = await fetchWithTimeout("https://data-asg.goldprice.org/dbXRates/USD");
    const goldJson = await goldRes.json();
    // goldJson yapÄ±sÄ± Ã¶rnek: { items: [ { curr: "USD", xauPrice: 1950.12, ... } ], ... }
    const onsUsd = goldJson && goldJson.items && goldJson.items[0] && goldJson.items[0].xauPrice;
    if (!onsUsd || isNaN(onsUsd)) throw new Error("Ons verisi boÅŸ");

    // 1 XAU (ons) = onsUsd USD
    // 1 USD = usdtry TRY
    // 1 XAU = onsUsd * usdtry TRY
    // 1 gram = (1 XAU TRY) / 31.1035
    const xauTry = onsUsd * usdtry;
    const gramAltin = xauTry / 31.1035;

    update("gold", gramAltin);

    el("time").textContent = "Son gÃ¼ncelleme: " + new Date().toLocaleTimeString("tr-TR",{hour12:false});
  }catch(err){
    console.error("Hata:", err);
    el("time").textContent = "Veri alÄ±namadÄ±";
  }
}

refresh();
setInterval(refresh, 15000);
</script>
</body>
</html>
