<script>
const el = id => document.getElementById(id);
const last = {};

function update(id,val){
  const e = el(id);
  const v = parseFloat(val);
  const prev = last[id];
  last[id] = v;
  e.textContent = isNaN(v) ? "--" : v.toFixed(2);
  if(prev){
    if(v>prev) e.className="value up";
    else if(v<prev) e.className="value down";
    else e.className="value";
  }
}

async function refresh(){
  try{
    const fxRes = await fetch("https://api.frankfurter.app/latest?from=USD&to=TRY,EUR,GBP");
    const fxData = await fxRes.json();
    if(!fxData || !fxData.rates) throw new Error("API boş");

    const usdtry = fxData.rates.TRY;
    const eurtry = usdtry / fxData.rates.EUR;
    const gbptry = usdtry / fxData.rates.GBP;

    // Altın fiyatı (ons) için ayrı kaynaktan:
    const goldRes = await fetch("https://data-asg.goldprice.org/dbXRates/USD");
    const goldData = await goldRes.json();
    const onsUsd = goldData.items[0].xauPrice;
    const gramAltin = (usdtry / onsUsd) / 31.1035;

    update("usd", usdtry);
    update("eur", eurtry);
    update("gbp", gbptry);
    update("gold", gramAltin);

    el("time").textContent = "Son güncelleme: " + new Date().toLocaleTimeString("tr-TR",{hour12:false});
  }catch(e){
    console.error("Hata:", e);
    el("time").textContent="Veri alınamadı";
  }
}

refresh();
setInterval(refresh, 15000);
</script>
